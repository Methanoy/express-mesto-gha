[![Tests](https://github.com/methanoy/express-mesto-gha/actions/workflows/tests-14-sprint.yml/badge.svg)](https://github.com/yandex-praktikum/express-mesto-gha/actions/workflows/tests-14-sprint.yml)
# Добро пожаловать на страницу серверной части приложения Mesto

В проекте реализована логика проверки токена, регистрирации и авторизации пользователей, сохранения и отправления пользователю карточек, присвоения и удаления лайков.

## 0.Оглавление
1.[Технологии](#technologies)
2.[Директории](#directories)
3.[Запуск проекта](#launch-project)
4.[Функционал](#features)
    - [Функционал для пользователей](#user-features)
        + [Регистрация пользователя](#signup-user)
        + [Авторизация пользователя](#signin-user)
        + [Завершение сеанса авторизации пользователя](#signout-user)
        + [Получение данных авторизованного пользователя](#get-auth-user-data)
        + [Получение данных всех зарегистрированных пользователей](#get-all-users)
        + [Получение данных пользователя по ID](#get-user-by-id)
        + [Редактирование информации о пользователе](#edit-user-data)
        + [Редактирование аватара пользователя](#edit-user-avatar)
    - [Функционал для карточек](#card-features)
        + [Создание карточки](#create-card)
        + [Получение данных всех созданных карточек](#get-all-cards)
        + [Удаление карточки](#delete-card)
        + [Добавление лайка карточке](#add-like)
        + [Удаление лайка с карточки](#delete-like)

## <a name ="technologies">1.Технологии</a>

- Node.js v16.15.0
- Express v4.18.1
- Mongoose v6.5.1
- MongoDB v4.4.15

## <a name ="directories">2.Директории</a>

`/routes` — папка с файлами роутера  
`/controllers` — папка с файлами контроллеров пользователя и карточки   
`/models` — папка с файлами описания схем пользователя и карточки
`/middlewares` - папка с файлами функций промежуточной обработки запросов при аутентификации, возникновении ошибок и валидации поступающих на сервер данных
`/errors` - папка с файлами собственных конструкторов ошибок
`/utils` - папка для утилит с файлом констант кодов ошибок  

## <a name ="launch-project">3.Запуск проекта</a>

1. Скопируйте
`npm run start` — запускает сервер   
`npm run dev` — запускает сервер с hot-reload
http://localhost:3000 - адрес для приёма запросов


## <a name ="features">4.Функционал</a>

### <a name ="signup-user">Регистрация пользователя</a>

Адрес: http://localhost:3000/signup
Метод: `POST`

Пример заполнения раздела body в запросе:

    {
      "name": "Alexey Gavrikov",
      "about": "Frontend developer",
      "avatar": "https://i.pinimg.com/736x/e4/dd/12/e4dd126d0d220e96a1d64aba5ec51255.jpg",
      "email": "a.e.gavrikoff@gmail.com",
      "password": "qwerty"
    }

Обязательными для направления являются только поля `email` и `password`, при отсутствии данных остальные будут заполнены шаблонами. 
Количество символов в значениях полей `name`, `about` должно быть не менее 2 и не более 30.

**Обратите внимание: функция осуществляет валидацию значений `email` и `avatar`, при некорректном указании почты и/или URL возвращается ошибка 400.**

Ответы сервера на запрос:
* `201` - успешная регистрация пользователя, сервер возвращает объект с полями: `name`, `about`, `avatar`, `email`.
* `400` - ошибка, в запросе переданы некорректные данные.
* `404` - ошибка, указан неправильный путь.
* `409` - ошибка, пользователь с аналогичным "email" уже зарегистрирован.
* `500` - ошибка на стороне сервера.

### <a name ="signin-user">Авторизация пользователя</a>

Адрес: http://localhost:3000/signin
Метод: `POST`

Пример заполнения раздела body в запросе:

    {
      "email": "a.e.gavrikoff@gmail.com",
      "password": "qwerty"
    }

Ответы сервера на запрос:
* `200` - успешная авторизация, сервер возвращает сообщение "Вы успешно авторизовались".
* `400` - ошибка, в запросе переданы некорректные данные.
* `404` - ошибка, указан неправильный адрес.
* `500` - ошибка на стороне сервера.

### <a name ="signout-user">Завершение сеанса авторизации пользователя</a>

Адрес: http://localhost:3000/signout
Метод: `GET`

В запросе не требуется заполнять body.
Перед направлением текущего запроса следует авторизоваться.

Ответы сервера на запрос:
* `200` - успешное завершение сеанса, сервер возвращает сообщение "Выход".
* `404` - ошибка, указан неправильный адрес.
* `500` - ошибка на стороне сервера.

### <a name ="get-auth-user-data">Получение данных авторизованного пользователя</a>

Адрес: http://localhost:3000/users/me
Метод: `GET`

В запросе не требуется заполнять body.
Перед направлением текущего запроса следует авторизоваться.

Ответы сервера на запрос:
* `200` - успешная авторизация, сервер возвращает объект с полями: `name`, `about`, `avatar`, `email`, `_id`.
* `401` - ошибка, требуется авторизация.
* `404` - ошибка, указан неправильный адрес или пользователя не существует.
* `500` - ошибка на стороне сервера.

### <a name ="get-all-users">Получение данных всех зарегистрированных пользователей</a>

Адрес: http://localhost:3000/users
Метод: `GET`

В запросе не требуется заполнять body.
Перед направлением текущего запроса следует авторизоваться.

Ответы сервера на запрос:
* `200` - успешный запрос, сервер возвращает массив с объектами зарегистрированных пользователей.
* `400` - ошибка, в запросе переданы некорректные данные.
* `401` - ошибка, требуется авторизация.
* `404` - ошибка, указан неправильный адрес.
* `500` - ошибка на стороне сервера.

### <a name ="get-user-by-id">Получение данных пользователя по ID</a>

Адрес: http://localhost:3000/users/:id
Метод: `GET`

В адресе вместо `:id` требуется подставить значение поля `_id` объекта уже зарегистрированного пользователя. Значение представляет собой строку из 24 цифр и букв латинского алфавита, например: `630a6faad3ec6628b82f21ed`. 
**Пример адреса:** `http://localhost:3000/users/630a6faad3ec6628b82f21ed`

В запросе не требуется заполнять body.
Перед направлением текущего запроса следует авторизоваться.

Ответы сервера на запрос:
* `200` - успешный запрос, сервер возвращает объект с полями: `name`, `about`, `avatar`, `email`, `_id`.
* `400` - ошибка, в запросе переданы некорректные данные.
* `401` - ошибка, требуется авторизация.
* `404` - ошибка, указан неправильный адрес или пользователя не существует.
* `500` - ошибка на стороне сервера.

### <a name ="edit-user-data">Редактирование информации о пользователе</a>

Адрес: http://localhost:3000/me
Метод: `PATCH`

Данная функция позволяет редактировать только поля `name` и/или `about` объекта уже зарегистрированного пользователя.
Количество символов в значениях полей `name`, `about` должно быть не менее 2 и не более 30.

Пример заполнения раздела body в запросе:

    {
      "name": "Alexey Gavrikov",
      "about": "Fullstack developer"
    }

Перед направлением текущего запроса следует авторизоваться.
**Обратите внимание: в запросе требуется передавать оба поля, даже если вы меняете значение только одного. Если значение другого поля менять не требуется, в нем указывается текущее значение.**

Ответы сервера на запрос:
* `200` - успешное редактирование данных, сервер возвращает объект с измененными данными пользователя.
* `400` - ошибка, в запросе переданы некорректные данные.
* `401` - ошибка, требуется авторизация.
* `404` - ошибка, указан неправильный адрес или пользователя не существует.
* `500` - ошибка на стороне сервера.

### <a name ="edit-user-avatar">Редактирование аватара пользователя</a>

Адрес: http://localhost:3000/me/avatar
Метод: `PATCH`

Данная функция позволяет редактировать только поле `avatar` объекта уже зарегистрированного пользователя.

Пример заполнения раздела body в запросе:

    {
      "avatar": "https://cinemax.ru/wp-content/uploads/2020/07/FhH28U5N5j0.jpg"
    }

Перед направлением текущего запроса следует авторизоваться.
**Обратите внимание: функция осуществляет валидацию передаваемого URL, при некорректном указании ссылки возвращается ошибка 400.**

Ответы сервера на запрос:
* `200` - успешное редактирование аватара, сервер возвращает объект с измененными данными пользователя.
* `400` - ошибка, в запросе переданы некорректные данные.
* `401` - ошибка, требуется авторизация.
* `404` - ошибка, указан неправильный адрес или пользователя не существует.
* `500` - ошибка на стороне сервера.

### <a name ="create-card">Создание карточки</a>

Адрес: http://localhost:3000/cards
Метод: `POST`

Пример заполнения раздела body в запросе:

    {
      "name": "The Legend of Zelda",
      "link": "https://i.pinimg.com/originals/33/e8/56/33e8564900520776f7bdfdacdb493271.jpg"
    }

Перед направлением текущего запроса следует авторизоваться.
Количество символов в значении поля `name` должно быть не менее 2 и не более 30.

**Обратите внимание: функция осуществляет валидацию значения `link`, при некорректном указании URL возвращается ошибка 400.**

Ответы сервера на запрос:
* `201` - успешное создание карточки, сервер возвращает объект с полями: `name`, `link`.
* `400` - ошибка, в запросе переданы некорректные данные.
* `401` - ошибка, требуется авторизация.
* `404` - ошибка, указан неправильный путь.
* `500` - ошибка на стороне сервера.

### <a name ="get-all-cards">Получение данных всех созданных карточек</a>

Адрес: http://localhost:3000/cards
Метод: `GET`

В запросе не требуется заполнять body.
Перед направлением текущего запроса следует авторизоваться.

Ответы сервера на запрос:
* `200` - успешный запрос, сервер возвращает массив с объектами созданных карточек.
* `400` - ошибка, в запросе переданы некорректные данные.
* `401` - ошибка, требуется авторизация.
* `404` - ошибка, указан неправильный адрес.
* `500` - ошибка на стороне сервера.

### <a name ="#delete-card">Удаление карточки</a>

Адрес: http://localhost:3000/cards/:id
Метод: `DELETE`

В адресе вместо `:id` требуется подставить значение поля `_id` объекта уже созданной карточки. Значение представляет собой строку из 24 цифр и букв латинского алфавита, например: `630f7e22255fd69a8e75f5e4`. 
**Пример адреса:** `http://localhost:3000/cards/630f7e22255fd69a8e75f5e4`

В запросе не требуется заполнять body.
Перед направлением текущего запроса следует авторизоваться.
**Обратите внимание: функция позволяет удалить карточку только её создателю, при попытке удалить карточку другого пользователя сервер вернет ошибку 403 и сообщение "Вы не можете удалить чужую карточку".**

Ответы сервера на запрос:
* `200` - успешное удаление карточки, сервер возвращает объект с данными удаленной карточки: `name`, `link`.
* `400` - ошибка, в запросе переданы некорректные данные.
* `401` - ошибка, требуется авторизация.
* `403` - ошибка, нельзя удалить чужую карточку.
* `404` - ошибка, указан неправильный адрес или пользователя не существует.
* `500` - ошибка на стороне сервера.

### <a name ="#add-like">Добавление лайка карточке</a>

Адрес: http://localhost:3000/cards/:id/likes
Метод: `PUT`

В адресе вместо `:id` требуется подставить значение поля `_id` объекта уже созданной карточки. Значение представляет собой строку из 24 цифр и букв латинского алфавита, например: `630f7e22255fd69a8e75f5e4`. 
**Пример адреса:** `http://localhost:3000/cards/630f7e22255fd69a8e75f5e4/likes`

В запросе не требуется заполнять body.
Перед направлением текущего запроса следует авторизоваться.

Ответы сервера на запрос:
* `200` - успешное добавление лайка карточке, сервер возвращает объект с данными карточки.
* `400` - ошибка, в запросе переданы некорректные данные.
* `401` - ошибка, требуется авторизация.
* `404` - ошибка, указан неправильный адрес или пользователя не существует.
* `500` - ошибка на стороне сервера.

### <a name ="#delete-like">Удаление лайка с карточки</a>

Адрес: http://localhost:3000/cards/:id/likes
Метод: `DELETE`

В адресе вместо `:id` требуется подставить значение поля `_id` объекта уже созданной карточки. Значение представляет собой строку из 24 цифр и букв латинского алфавита, например: `630f7e22255fd69a8e75f5e4`. 
**Пример адреса:** `http://localhost:3000/cards/630f7e22255fd69a8e75f5e4/likes`

В запросе не требуется заполнять body.
Перед направлением текущего запроса следует авторизоваться.

Ответы сервера на запрос:
* `200` - успешное удаление лайка с карточки, сервер возвращает объект с данными карточки.
* `400` - ошибка, в запросе переданы некорректные данные.
* `401` - ошибка, требуется авторизация.
* `404` - ошибка, указан неправильный адрес или пользователя не существует.
* `500` - ошибка на стороне сервера.
